<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>收银台</title>
    <link rel="stylesheet" href="../static/css/cashier.css">
    <link rel="shortcut icon" href="../static/image/head.ico">
</head>

<body >
    <div class="app">
        <div class="app_header">
            <div class="header_content ">
                <div class="app_w">
                    <ul>
                        <li><a href="#">我的美团</a></li>
                        <li><a href="#">手机APP</a></li>
                        <li><a href="#">商家中心</a></li>
                        <li><a href="#">美团规则</a></li>
                        <li><a href="#">网站导航</a></li>
                    </ul>
                </div>
            </div>

            <div class="logo_header ">
                <div class="app_w">
                    <a href="#">
                        <img src="../static/image/logo_meituan.png" alt="">
                    </a>
                </div>
            </div>
        </div>

        <div class="app_body app_w">
            <div class="app_cd">
                <i class="icon icon_sand"></i>
                <span class="app_cd_text" id="timer">
                    
                </span>
            </div>

            <div class="order">
                <span class="block_left">
                    项目：订单编号:00
                </span>
                <div class="block_right">
                    <span class="price_text">
                        应付金额￥
                    </span>
                    <span class="amount_price">
                        0.0
                    </span>
                </div>
            </div>

            <div class="payment_container">
                <div class="payment_type">
                    <ul class="payment_menu">
                        <li class="payment_tab payment_tab_0">
                            <a>支付宝/微信</a>
                        </li>
                        <li class="payment_tab payment_tab_1">
                            
                        </li>
                    </ul>

                    <ul class="payment_tips">
                        <li>
                            <a href="">
                                支付帮助
                                <span class="payment_tips_arrow"></span>
                            </a>
                        </li>
                        <li><a href="">意见反馈</a></li>
                    </ul>

                    <div class="payment_list">
                        <ul class="clear_fix">
                            <li>
                                
                                <span class="payment_icon">
                                    <img src="../static/image/pc_wxqrpay.png" alt="" >
                                    <img src="../static/image/wechat.JPG" alt=""width="145px" height="145px">
                                </span>
                            </li>
                            <li>
                                
                                <span class="payment_icon">
                                    <img src="../static/image/alipaypcnew.png" alt="" >
                                    <img src="../static/image/qq.JPG" alt=""width="145px" height="145px">
                                </span>


                            </li>
                        </ul>
                    </div>


                </div>
                <div class="payment_submit_area">
                    <div class="amount">
                        支付￥
                        <span class="amount_price">0.0</span>
                    </div>

                    <div class="payment_submit">
                        <a href="#" class="btn">付款</a>
                    </div>

                    <div class="payment_back">
                        <a href="pay.html">返回查看订单</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="app_footer">
            <div class="footer_conter">
                <div class="footer_link">
                    <div class="footer_column">
                        <dl>
                            <dt>用户帮助</dt>
                            <dd>
                                <a href="#">申请退款</a>
                            </dd>
                            <dd>
                                <a href="#">常见问题</a>
                            </dd>
                            <dd>
                                <a href="#">用户协议</a>
                            </dd>
                            <dd>
                                <a href="#">隐私政策</a>
                            </dd>
                            <dd>
                                <a href="#">反诈骗公告</a>
                            </dd>
                            <dd>
                                <a href="#">消费者保障协议</a>
                            </dd>
                        </dl>

                        <dl>
                            <dt>美团服务</dt>
                            <dd>
                                <a href="#">美团外卖</a>
                            </dd>
                            <dd>
                                <a href="#">美团酒店</a>
                            </dd>
                            <dd>
                                <a href="#">猫眼电影</a>
                            </dd>
                            <dd>
                                <a href="#">美团配送</a>
                            </dd>
                            <dd>
                                <a href="#">美团云</a>
                            </dd>
                            <dd>
                                <a href="#">大众点评</a>
                            </dd>
                            <dd>
                                <a href="#">美团民宿</a>
                            </dd>
                            <dd>
                                <a href="#">无人配送</a>
                            </dd>
                            <dd>
                                <a href="#">企业用餐、企业差旅</a>
                            </dd>
                        </dl>
                    </div>
                    <div class="footer_column">
                        <dl>
                            <dt>商家合作</dt>
                            <dd>
                                <a href="#">美食商家入驻(非外卖)</a>
                            </dd>
                            <dd>
                                <a href="#">美团外卖开店申请</a>
                            </dd>
                            <dd>
                                <a href="#">美团收银官网</a>
                            </dd>
                            <dd>
                                <a href="#">美团配送合作申请</a>
                            </dd>
                            <dd>
                                <a href="#">美团餐饮学院</a>
                            </dd>
                            <dd>
                                <a href="#">酒店商家入驻</a>
                            </dd>
                            <dd>
                                <a href="#">境内度假商家入驻</a>
                            </dd>
                            <dd>
                                <a href="#">综合商家入驻</a>
                            </dd>
                            <dd>
                                <a href="#">美团民宿房东商家入驻</a>
                            </dd>
                            <dd>
                                <a href="#">商家开票申请</a>
                            </dd>
                            <dd>
                                <a href="#">美团智能收银机</a>
                            </dd>
                            <dd>
                                <a href="#">美团餐饮开放平台</a>
                            </dd>
                            <dd>
                                <a href="#">美团收单</a>
                            </dd>
                            <dd>
                                <a href="#">免费使用美团排队</a>
                            </dd>
                            <dd>
                                <a href="#">快驴进货商家合作</a>
                            </dd>
                            <dd>
                                <a href="#">美团闪购商家入驻</a>
                            </dd>
                        </dl>
                    </div>
                    <div class="footer_column">
                        <dl>
                            <dt>合作商招募</dt>
                            <dd><a href="#">美团外卖合作商招募</a></dd>
                            <dd><a href="#">到店餐饮合作商招募</a></dd>
                            <dd><a href="#">到店综合业务合作商招募</a></dd>
                            <dd><a href="#">美团联盟</a></dd>
                            <dd><a href="#">美团收银招募线上分销商</a></dd>
                            <dd><a href="#">美团收银合作商招募</a></dd>
                            <dd><a href="#">美团收单合作商招募</a></dd>
                            <dd><a href="#">美团充电宝合作商招募</a></dd>
                        </dl>

                        <dl>
                            <dt>美团规则</dt>
                            <dd><a href="#">规则中心</a></dd>
                            <dd><a href="#">规则目录</a></dd>
                            <dd><a href="#">规则评议院</a></dd>
                        </dl>
                    </div>
                    <div class="footer_column">
                        <dl>
                            <dt>关注美团</dt>
                            <dd><a href="#">美团新浪微博</a></dd>
                        </dl>

                        <dl>
                            <dt>公司信息</dt>
                            <dd><a href="#">关于我们</a></dd>
                            <dd><a href="#">投资者关系</a></dd>
                            <dd><a href="#">加入我们</a></dd>
                            <dd><a href="#">商户诚信公约及管理方法</a></dd>
                            <dd><a href="#">保险经纪资质</a></dd>
                        </dl>

                        <dl>
                            <dt>廉政举报</dt>
                            <dd><a href="#">廉政举报平台</a></dd>
                        </dl>

                        <dl>
                            <dt>知识产权</dt>
                            <dd><a href="#">知识产权维护平台</a></dd>
                        </dl>
                    </div>
                    <div class="footer_column">
                        <dl>
                            <dt>消费者服务热线</dt>
                            <dd><a href="#">外卖消费者：10109777</a></dd>
                            <dd><a href="#">猫眼消费者：10105335</a></dd>
                            <dd><a href="#">其他消费者：10107888</a></dd>
                        </dl>

                        <dl>
                            <dt>商家服务热线</dt>
                            <dd><a href="#">外卖&餐饮商家：10105557</a></dd>
                            <dd><a href="#">休闲娱乐、丽人、ktv、教育、结婚、亲子、家装等商家：10100107</a></dd>

                        </dl>

                        <dl>
                            <dt>投诉举报专区</dt>
                            <dd><a href="#">违法和不良信息举报：4006018900</a></dd>
                            <dd><a href="#">举报邮箱：tousujubao@meituan.com</a></dd>
                            <dd><a href="#">网上有害信息举报</a></dd>
                        </dl>

                        <dl>
                            <dt><a href="#">商家自助入驻美团入口</a></dt>
                        </dl>

                        <dl>
                            <dt><a href="#">供应商注册入口</a></dt>
                        </dl>
                    </div>
                </div>

                <div class="footer_copyright">
                    <div class="footer_copyright_left">
                        <p>
                            ©美团网团购 meituan.com
                            <a href="h#" style="margin-left: 20px;">京ICP证070791号</a>
                            <a href="#">京ICP备10211739号-1</a>
                        </p>
                        <p>
                            <a href="#" target="_blank">广播电视节目制作经营许可证（京）字第03889号</a>
                        </p>
                        <p>
                            <a href="#" target="_blank">食品经营许可证</a>
                            <a href="#" target="_blank">互联网药品信息服务资格证 (京)-经营性-2017-0014</a>
                        </p>
                        <p>
                            <a href="#" target="_blank">医疗器械网络交易服务第三方平台备案：（京）网械平台备字[2018]第00004号</a>
                        </p>
                        <p>
                            <a href="#" target="_blank">平台EDI许可证</a>
                        </p>
                    </div>
                    <div class="footer_copyright_right">
                        <a href="#" target="_blank">
                            <img class="beianicon" src="../static/image/police.png">京公网安备 11000002002052号
                        </a>

                        <div class="footer_copyright_cert">
                            <a href="#">
                                <img src="../static/image/yingye.png" alt="">
                                <p>北京三快科技有限公司</p>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="../node_modules/jQuery/dist/jquery.js"></script>
<script>

    if(!jQuery.isEmptyObject(JSON.parse(sessionStorage.getItem('unPayInformation')))  ){
        var userJsonStr = sessionStorage.getItem('unPayInformation');
        var userEntity = JSON.parse(userJsonStr);
        console.log(userEntity)
        $.ajax({
            url: `http://localhost:8080/getOrderTime/${userEntity.id}`,
            type: 'get',
            dataType: 'json',
            async: false,
            contentType: 'application/json;charset=UTF-8',
            success: data => {
                
                maxtime =Number(data.time-1)  //一个小时，按秒计算，自己调整!  
                console.log(maxtime)
                if(maxtime>0){
                minutes = Math.floor(maxtime / 60);
                seconds = Math.floor(maxtime % 60);
                // msg = "距离结束还有"+minutes+"分"+seconds+"秒";  
                $("#timer").empty();
                var str = ``;
                str += `请在<span class="minute">${minutes}</span> 分钟
            <span class="second">${seconds}</span> 秒内完成支付
        `
                var parent = $("#timer");
                parent.append(str)
                }
                
            }
        })

        function CountDown() {
            if (maxtime >= 0) {
                minutes = Math.floor(maxtime / 60);
                seconds = Math.floor(maxtime % 60);
                // msg = "距离结束还有"+minutes+"分"+seconds+"秒";  
                $("#timer").empty();
                var str = ``;
                str += `请在<span class="minute">${minutes}</span> 分钟
            <span class="second">${seconds}</span> 秒内完成支付`

                $(".btn").on("click",function(){
                    $.ajax({
                    url: `http://localhost:8080/saveMoney`,
                    type: 'post',
                    dataType: 'json',
                    async: false,
                    data:JSON.stringify(userEntity) ,
                    contentType: 'application/json;charset=UTF-8',
                    success: data => {
                        $(".btn").html("支付完毕");
                        $(".btn ").css({"background-color":"#ef4238" })
                        $(".payment_back a").html(" ")
                        $("#timer").html(" ")
                        clearInterval(timer);
                    }
                    })
                })
                
                var parent = $("#timer");
                parent.append(str)
                if (maxtime == 5 * 60) alert('注意，还有5分钟!');
                --maxtime;
            } else {
                clearInterval(timer);
                alert("时间到，结束!");
                $(".btn").html("无法支付")
                $(".payment_back a").html(" ")
                $(".btn ").css({"background-color":"#e5e5e5" ,
                                "cursor":"pointer",
                                "pointer-events": "none"
                                })
                
            }
        }
        
        timer = setInterval("CountDown()",1000);  


        $(".block_left").html(`项目：订单编号:${userEntity.id}`);
        $(".amount_price").html(userEntity.orderMoney)
        
        window.onbeforeunload = function(e) {
        var dialogText = 'Dialog text here';
        e.returnValue = dialogText;
        return dialogText;
        };
    }
    else{
        var userJsonStr = sessionStorage.getItem('planInformation');
    var userEntity = JSON.parse(userJsonStr);
    console.log(userEntity)

    var userJsonStr1 = sessionStorage.getItem('seatInformation');
    var userEntity1 = JSON.parse(userJsonStr1);
    console.log(userEntity1)


    var userJsonStr2 = sessionStorage.getItem('orderIformation');
    var userEntity2 = JSON.parse(userJsonStr2);
    console.log(userEntity2)

    $.ajax({
            url: `http://localhost:8080/getOrderTime/${userEntity2.orderId}`,
            type: 'get',
            dataType: 'json',
            async: false,
            contentType: 'application/json;charset=UTF-8',
            success: data => {
                
                maxtime =Number(data.time-1)  //一个小时，按秒计算，自己调整!  
                console.log(maxtime)
                if(maxtime>0){
                minutes = Math.floor(maxtime / 60);
                seconds = Math.floor(maxtime % 60);
                // msg = "距离结束还有"+minutes+"分"+seconds+"秒";  
                $("#timer").empty();
                var str = ``;
                str += `请在<span class="minute">${minutes}</span> 分钟
            <span class="second">${seconds}</span> 秒内完成支付
        `
                var parent = $("#timer");
                parent.append(str)
                }
                
            }
        })

        var data = {
            "cinemaId": Number(userEntity.cinemaId),
            "id":Number(userEntity2.orderId)  ,
            "movieId": Number(userEntity.movieId),
            "orderMoney":Number(userEntity1.orderMoney) 
        }
        console.log(data)
        function CountDown() {
            if (maxtime >= 0) {
                minutes = Math.floor(maxtime / 60);
                seconds = Math.floor(maxtime % 60);
                // msg = "距离结束还有"+minutes+"分"+seconds+"秒";  
                $("#timer").empty();
                var str = ``;
                str += `请在<span class="minute">${minutes}</span> 分钟
            <span class="second">${seconds}</span> 秒内完成支付`

                $(".btn").on("click",function(){
                    $.ajax({
                    url: `http://localhost:8080/saveMoney`,
                    type: 'post',
                    dataType: 'json',
                    async: false,
                    data:JSON.stringify(data) ,
                    contentType: 'application/json;charset=UTF-8',
                    success: data => {
                        $(".btn").html("支付完毕");
                        $(".btn ").css({"background-color":"#ef4238" })
                        $(".payment_back a").html(" ")
                        $("#timer").html(" ")
                        clearInterval(timer);
                    }
                    })
                })
                
                var parent = $("#timer");
                parent.append(str)
                if (maxtime == 5 * 60) alert('注意，还有5分钟!');
                --maxtime;
            } else {
                clearInterval(timer);
                alert("时间到，结束!");
                $(".btn").html("无法支付")
                $(".payment_back a").html(" ")
                $(".btn ").css({"background-color":"#e5e5e5" ,
                                "cursor":"pointer",
                                "pointer-events": "none"
                                })
                
            }
        }
        
        timer = setInterval("CountDown()",1000);  


        $(".block_left").html(`项目：订单编号:${userEntity2.orderId}`);
        $(".amount_price").html(userEntity1.orderMoney)
        
        window.onbeforeunload = function(e) {
        var dialogText = 'Dialog text here';
        e.returnValue = dialogText;
        return dialogText;
        };
    }

    

       
</script>
</html>