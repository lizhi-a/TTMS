
var cancelLogin = document.getElementById("cancelLogin");
var iloginBtn = document.getElementById("iloginBtn");
var modal_container = document.getElementsByClassName("modal-container")[0];


console.log(seat)

var price =Number(userEntity.ticketMoney) ; //票价
var count = 0;
	$(document).ready(function() {
		var $cart = $('#selected-seats'), //座位区
		$counter = $('#counter'), //票数
		$total = $('#total'); //总计金额
		// var row =5 ;
		// var col = 6;
		var map=new Array();
		for(var i = 0;i<row;i++){
			map[i]="";
			for(var j=0;j<col;j++){
				map[i]+="a";
			}
		}
		console.log(map);
		
	
		var sc = $('#seat-map').seatCharts({
			 //座位图
			map: map,
			naming : {
			top : false,
			getLabel : function (character, row, column) {
				return column;
			}
		},
		legend : { //定义图例
			node : $('#legend'),
			items : [
				[ 'a', 'available',   '可选座' ],
				[ 'a', 'unavailable', '已售出']
			]
		},
		click: function () { //点击事件
			if (this.status() == 'available') { //可选座
				if(count>3){
					alert("最多购买4张！");
					return this.style();
				}
                count++;
				console.log(count);
                cancelLogin.style.display = "none";
                iloginBtn.style.display ="inline-block";
                $(`<li data-row = ${this.settings.row+1} data-col = ${this.settings.label}>`+(this.settings.row+1)+'排'+this.settings.label+'座</li>')
				.attr('id', 'cart-item-'+this.settings.id)
				.data('seatId', this.settings.id)
				.appendTo($cart);
				$counter.text(sc.find('selected').length+1);
				$total.text(recalculateTotal(sc)+price);
				return 'selected';		
			} 
			else if (this.status() == 'selected') { //已选中
				//更新数量
				$counter.text(sc.find('selected').length-1);
				//更新总计
				$total.text(recalculateTotal(sc)-price);
				//删除已预订座位
				$('#cart-item-'+this.settings.id).remove();
                count--;
                if(count==0){
                    cancelLogin.style.display = "inline-block";
                	iloginBtn.style.display ="none";
                }
				//可选座
					return 'available';
			} 
			else if (this.status() == 'unavailable') { //已售出
				return 'unavailable';
			} 
			else {
				return this.style();
			}
		}
	});
	//已售出的座位
	var soldSeat = [];
	// console.log(seat[1,1])
	// for(var i in seat){
	// 	console.log(seat[i])
	// 	if(seat[i]==0){
	// 		soldSeat.push(i.replace(',', '_'))
	// 	}
	// }
	var value = '';
	Object.keys(seat).forEach(function(key){
		// console.log(seat[key])
		// value = seat[key].substr(1,seat[key].length-2);
		if(seat[key]=="1"){
			soldSeat.push(key.replace(',','_'))
		}
	})
	console.log(soldSeat)
	sc.get(soldSeat).status('unavailable');
	});
	
	//计算总金额
	function recalculateTotal(sc) {
		var total = 0;
		sc.find('selected').each(function () {
			total += price;
		});
		return total;
	}


